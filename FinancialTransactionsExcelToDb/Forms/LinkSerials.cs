using FinancialTransactionsExcelToDb.Models;
using Newtonsoft.Json;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace FinancialTransactionsExcelToDb.Forms
{
    public partial class LinkSerials : Form
    {
        string token = "";

        Dictionary<string, string> serialsDic;

        public LinkSerials()
        {
            InitializeComponent();
        }

        private async void btnLogin_Click(object sender, EventArgs e)
        {
            btnLogin.Enabled = false;

            token = await Common.Common.LoginUser("Machine", "MachineParlar");

            btnLogin.Enabled = true;
        }

        private void btnGetIds_Click(object sender, EventArgs e)
        {
            btnGetIds.Enabled = false;

            serialsDic = new Dictionary<string, string>
            {
              {"059300027463388",   "0593098991"},
{"057600026225173", "0576001024"},
{"056100026236712", "056100013"},
{"055400028099069", "055409598099064"},
{"054700026776851", "054709596776849"},
{"054000028152348", "054000982000470"},
{"054000028152347", "054000982000470"},
{"051600027582699", "051600058"},
{"047000027668495", "0470001082"},
{"047000027668494", "0470001069"},
{"046800027802502", "04680010348"},
{"046800027802501", "04680010338"},
{"044000027802506", "04400010176"},
{"044000027802503", "0440087522"},
{"044000027802504", "0440087521"},
{"044000027802505", "04400010175"},
{"041000028224994", "041025658224525"},
{"025600028161763", "025600755"},
{"025600028161764", "0256001092"},
{"025600028161762", "0256000553"},
{"025600028161761", "0256007518"},
{"025000028224625", "07509598108828"},
{"019800028041179", "0198010148040980"},
{"019800028041178", "0198010148040981"},
{"018400027158655", "018400059"},
{"012300028232980", "012309688232828"},
{"008500028047527", "0085096014"},
{"007500028108836", "007509598108791"},
{"005500027888509", "005500027888508"},
{"004200028205040", "0042095927"},
{"00270002849633",  "0027001368"},
{"73970002000012",  "73970982000005"},
{"72080002000006",  "72080103000002"},
{"72080002000005",  "72080103000002"},
{"69150002000005",  "69150962000001"},
{"67850002000004",  "67850982000003"},
{"67600002000005",  "67600982000003"},
{"66890002000005",  "66890982000004"},
{"65610002000008",  "65610982000002"},
{"62500002000004",  "62501977000002"},
{"62490002000003",  "62490982000001"},
{"59230002000046",  "59230982000043"},
{"58180002000324",  "58182580000319"},
{"58160002000382",  "58162580000322"},
{"57890002000163",  "57890982000152"},
{"57890002000162",  "57890982000153"},
{"57890002000161",  "57890982000160"},
{"57280002000043",  "57281979000026"},
{"54000002000472",  "54000982000470"},
{"53340002000002",  "533400381"},
{"51140002000364",  "51140002000345"},
{"506500028014910", "506509591"},
{"497700028005887", "497701031"},
{"493900027786518", "493927187786487"},
{"475600028158509", "475625918158506"},
{"46980002000067",  "4698204800025"},
{"458300028013866", "458325808013829"},
{"457100027945439", "457110147945434"},
{"453600028022978", "453609598022970"},
{"450200027945441", "450210147945433"},
{"450100027945440", "3829101455"},
{"450000027945437", "450010141"},
{"449900028118022", "449909828118014"},
{"445500027818533", "445509827818532"},
{"429900027064088", "429909824"},
{"423400027818150", "423419747818144"},
{"417300027839271", "417309636"},
{"410400028141661", "4104168615"},
{"409300028147610", "4093096013"},
{"405700028116876", "405710141"},
{"405100028181735", "405109893"},
{"39280002000052",  "39280977000048"},
{"391500028077142", "391509598077139"},
{"386800028076132", "386809598076124"},
{"382900027905588", "3829101455"},
{"375000027314847", "375000027314821"},
{"360200028231432", "360213358231368"},
{"356400028144314", "356413358144272"},
{"350200026561776", "350225806561760"},
{"350000027591111", "350012567591110"},
{"347900027719533", "347909597719529"},
{"346100028202235", "346109828202225"},
{"346000027714764", "346000387714728"},
{"322200028147952", "322209828147950"},
{"319100028189066", "319133208188943"},
{"319100028189065", "319133208188575"},
{"319100028189064", "319133208188938"},
{"315900028016558", "315909821"},
{"313700027883720", "313710397883714"},
{"313600027841230", "313609827841227"},
{"309300025934875", "309309621"},
{"309300025934874", "309309626"},
{"307700027682582", "3077096014"},
{"303400026440924", "303400106440893"},
{"296200027784400", "296209827784397"},
{"293900028108195", "2939000516"},
{"292000028003534", "292010138003525"},
{"286900027928958", "286909827928953"},
{"279800026236730", "2798009620"},
{"279700025936681", "2797009622"},
{"276500026236473", "2765098233"},
{"271900027955251", "2719098965"},
{"271900027955250", "2719098977"},
{"270000028158708", "270011068158705"},
{"270000028158706", "270011068158705"},
{"269700026741357", "2697098212"},
{"268600025943646", "268609741"},
{"268400027669082", "268400811"},
{"264600027315774", "264605271"},
{"256200025943640", "256200105943638"},
{"253500028171596", "253519798171381"},
{"250800025484197", "250809825484196"},
{"237300027192870", "237309597192860"},
{"237100028228383", "237119798228350"},
{"237100028228382", "237119798228302"},
{"227500028165104", "227509828165049"},
{"224300028227399", "224309598227341"},
{"212100022644319", "212100054"},
{"195100027687341", "1951096015"},
{"191500028037759", "191509598037758"},
{"186600027955647", "186610137955608"},
{"186600027955646", "186610137955616"},
{"186200027952951", "186209628"},
{"181800027686862", "1818096018"},
{"178200027667285", "178209592"},
{"169200026236637", "1692000559"},
{"169100027491871", "169109597491862"},
{"163500025701019", "163500963"},
{"139900028148099", "139903538148080"},
{"124400027828223", "124409627828222"},
{"123400028232677", "123433208232615"},
{"123400028232676", "123433208232536"},
{"121000027819145", "121027047819140"},
{"120900026236864", "120900051"},
{"110600027480880", "110625537480789"},
{"110600027480879", "110609597480861"},
{"110100024425388", "110100394"},
{"102300028096002", "102309598095964"},
{"102300028096001", "102309598095990"},
            };

            btnGetIds.Enabled = true;
        }

        private async void btnAddRialInvoice_Click(object sender, EventArgs e)
        {
            btnAddRialInvoice.Enabled = false;

            var counter = 0;
            foreach (var serial in serialsDic)
            {
                var newSerial = serial.Key;
                var oldSerial = serial.Value;

                AddLinkSerialInput addLinkSerialInput = new AddLinkSerialInput
                {
                    CustomerId = 2,
                    LinkedSerials = new string[] { newSerial }
                };

                var json = await Common.Common.Post(token: token, requestUri: "api/WarehouseManagement/AddLinkSerial", addLinkSerialInput);
                richTextBox1.AppendText($"\n{DateTime.Now}: AddLinkSerial: OldSerial: {oldSerial} Result: {json}");

                GetStuffSerialInput getStuffSerialInput = new GetStuffSerialInput
                {
                    Serial = oldSerial
                };

                var getStuffSerialJson = await Common.Common.Post(token: token, requestUri: "api/WarehouseManagement/GetStuffSerial", getStuffSerialInput);
                var getStuffSerialResult = JsonConvert.DeserializeObject<Result<StuffSerialResult>>(getStuffSerialJson);

                if (getStuffSerialResult.Data == null) continue;

                AddDetemineLinkForSerialInput addDetemineLinkForSerialInput = new AddDetemineLinkForSerialInput
                {
                    LinkSerial = newSerial,
                    StuffId = getStuffSerialResult.Data.StuffId,
                    StuffSerialCode = getStuffSerialResult.Data.Code
                };

                var addDetemineLinkForSerialJosn = await Common.Common.Post(token: token, requestUri: "api/WarehouseManagement/DetemineLinkForSerial", addDetemineLinkForSerialInput);
                var addDetemineLinkForSerialResult = JsonConvert.DeserializeObject<Result>(addDetemineLinkForSerialJosn);

                counter++;
                richTextBox1.AppendText($"\nCounter: {counter} of {serialsDic.Count()} - {DateTime.Now} - NewSerial: {newSerial} - OldSerial: {oldSerial} - Result: {json}");

                richTextBox1.SelectionStart = richTextBox1.Text.Length;
                richTextBox1.ScrollToCaret();
            }

            btnAddRialInvoice.Enabled = true;
        }
    }
}
